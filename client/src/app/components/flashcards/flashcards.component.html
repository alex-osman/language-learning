<div class="flashcards-container">
  <h2>Spaced Repetition Flashcards</h2>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <p>Loading flashcards...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadDueCards()">Try Again</button>
  </div>

  <!-- Review in Progress -->
  <div *ngIf="isReviewing && currentCard" class="review-container">
    <div class="review-progress">
      <p>
        {{ reviewStats.correct + reviewStats.incorrect }} of {{ reviewStats.total }} cards reviewed
      </p>
      <div
        class="progress-bar"
        role="progressbar"
        [attr.aria-valuenow]="reviewStats.correct + reviewStats.incorrect"
        [attr.aria-valuemin]="0"
        [attr.aria-valuemax]="reviewStats.total"
      >
        <div
          class="progress"
          [style.width.%]="
            ((reviewStats.correct + reviewStats.incorrect) / reviewStats.total) * 100
          "
        ></div>
      </div>
    </div>

    <div
      class="flashcard"
      [class.flipped]="isFlipped"
      [class.processing]="isProcessingReview"
      (click)="flipCard()"
      role="button"
      tabindex="0"
      (keydown.space)="flipCard()"
      aria-label="Flashcard - tap to flip"
    >
      <div class="flashcard-inner">
        <div class="flashcard-front">
          <div class="character" [class.processing]="isProcessingReview">
            {{ currentCard.character }}
          </div>
          <p class="hint">Tap to reveal</p>
        </div>
        <div class="flashcard-back" [class.processing]="isProcessingReview">
          <div class="character">{{ currentCard.character }}</div>
          <div class="pinyin">{{ currentCard.pinyin }}</div>
          <div class="definition">{{ currentCard.definition }}</div>
          <button
            class="audio-btn"
            (click)="$event.stopPropagation(); playAudio(currentCard)"
            [disabled]="isProcessingReview"
            aria-label="Play audio pronunciation"
          >
            ðŸ”Š Play Audio
          </button>
        </div>
      </div>
    </div>

    <div class="review-actions" *ngIf="isFlipped">
      <p>How well did you remember this?</p>
      <div class="rating-buttons" [class.disabled]="isProcessingReview">
        <button
          class="rating-btn bad"
          (click)="submitReview(0)"
          [disabled]="isProcessingReview"
          [class.selected]="selectedRating === 0"
          data-mobile-label="0 - Complete Blackout"
        >
          <span>0 - Complete Blackout</span>
        </button>
        <button
          class="rating-btn bad"
          (click)="submitReview(1)"
          [disabled]="isProcessingReview"
          [class.selected]="selectedRating === 1"
          data-mobile-label="1 - Recognized only"
        >
          <span>1 - Remembered after seeing answer</span>
        </button>
        <button
          class="rating-btn bad"
          (click)="submitReview(2)"
          [disabled]="isProcessingReview"
          [class.selected]="selectedRating === 2"
          data-mobile-label="2 - Easy after seeing"
        >
          <span>2 - Incorrect, but seemed easy after</span>
        </button>
        <button
          class="rating-btn ok"
          (click)="submitReview(3)"
          [disabled]="isProcessingReview"
          [class.selected]="selectedRating === 3"
          data-mobile-label="3 - Difficult recall"
        >
          <span>3 - Correct with difficulty</span>
        </button>
        <button
          class="rating-btn good"
          (click)="submitReview(4)"
          [disabled]="isProcessingReview"
          [class.selected]="selectedRating === 4"
          data-mobile-label="4 - Slight hesitation"
        >
          <span>4 - Correct after hesitation</span>
        </button>
        <button
          class="rating-btn perfect"
          (click)="submitReview(5)"
          [disabled]="isProcessingReview"
          [class.selected]="selectedRating === 5"
          data-mobile-label="5 - Perfect recall"
        >
          <span>5 - Perfect recall</span>
        </button>
      </div>
      <div *ngIf="isProcessingReview" class="processing-indicator">
        <p>Processing...</p>
      </div>
    </div>
  </div>

  <!-- No cards to review -->
  <div
    *ngIf="!isLoading && !error && dueCards.length === 0 && !isReviewing && !reviewCompleted"
    class="no-cards"
  >
    <p>No cards due for review today!</p>
    <p>Come back tomorrow or add new characters to study.</p>
  </div>

  <!-- Review Completed -->
  <div *ngIf="reviewCompleted" class="review-completed">
    <h3>Review Session Completed! ðŸŽ‰</h3>
    <div class="review-summary">
      <div class="stat">
        <span class="stat-value">{{ reviewStats.total }}</span>
        <span class="stat-label">Total Cards</span>
      </div>
      <div class="stat correct">
        <span class="stat-value">{{ reviewStats.correct }}</span>
        <span class="stat-label">Correct</span>
      </div>
      <div class="stat incorrect">
        <span class="stat-value">{{ reviewStats.incorrect }}</span>
        <span class="stat-label">Incorrect</span>
      </div>
    </div>

    <p>
      Great job! The spaced repetition algorithm will schedule these cards for review at optimal
      intervals.
    </p>
    <button class="reset-btn" (click)="resetReview()">Start New Review</button>
  </div>
</div>
