<div class="scene-overview">
  <!-- Header -->
  <div class="header">
    <button class="back-button" (click)="goBack()" aria-label="Go back">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M19 12H5M12 19L5 12L12 5"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      Back
    </button>
    <h1>Scene Overview</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <p>Loading scene data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
  </div>

  <!-- Content -->
  <ng-container *ngIf="!isLoading && !error && sceneData">
    <!-- Scene Card -->
    <div class="scene-card">
      <div class="scene-image">
        <img [src]="sceneData.imageUrl" [alt]="sceneData.title" />
      </div>
      <div class="scene-info">
        <h2>{{ sceneData.title }}</h2>
        <p>{{ sceneData.percentUnderstood }}% understood</p>
        <p>{{ sceneData.newSentencesCount }} new sentences</p>
      </div>
      <div class="progress-circle">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <circle cx="40" cy="40" r="35" fill="none" stroke="#f0f0f0" stroke-width="8" />
          <circle
            cx="40"
            cy="40"
            r="35"
            fill="none"
            stroke="#ff9800"
            stroke-width="8"
            stroke-linecap="round"
            [attr.stroke-dasharray]="2 * Math.PI * 35"
            [attr.stroke-dashoffset]="2 * Math.PI * 35 * (1 - sceneData.percentUnderstood / 100)"
            transform="rotate(-90 40 40)"
          />
        </svg>
        <div class="progress-text">{{ sceneData.percentUnderstood }}%</div>
      </div>
    </div>

    <!-- Unique Characters Section -->
    <div class="unique-characters">
      <h3>Unique characters in this scene</h3>
      <div class="characters-grid">
        <app-character-tile
          *ngFor="let character of displayedCharacters"
          [character]="character"
        ></app-character-tile>
        <div class="ellipsis-tile" *ngIf="hasMoreCharacters">...</div>
      </div>
    </div>

    <!-- Sentence Gallery -->
    <div class="sentence-gallery">
      <h3>Sentence gallery</h3>
      <div class="sentences-list">
        <div *ngFor="let sentence of sceneData.sentences" class="sentence-card">
          <div class="sentence-content">
            <p class="chinese">{{ sentence.chinese }}</p>
            <div class="sentence-meta">
              <span class="percent-known">{{ sentence.percentKnown }}% known</span>
              <span class="status">status: {{ sentence.status }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Sticky Footer -->
  <div class="footer" *ngIf="!isLoading && !error">
    <button class="start-practice-btn" (click)="startPractice()">Start Practice</button>
  </div>
</div>
