<div class="section characters">
  <h2>Characters Progress</h2>
  <div class="progress-stats">{{ charactersProgress }}</div>
  <div class="grid">
    <ng-container *ngFor="let char of filteredCharacters">
      <div
        class="cell"
        [class.has-data]="hasCharacterData(char)"
        [class.no-data]="!hasCharacterData(char)"
        (mouseenter)="onCharacterHover(char)"
      >
        <div class="cell-content">
          <div class="character">{{ char.character }}</div>
          <ng-container *ngIf="hasCharacterData(char)">
            <div class="pinyin">{{ getCharacterPinyin(char) }}</div>
            <div class="definition">{{ getCharacterDefinition(char) }}</div>
          </ng-container>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Movie Scene Info Panel -->
  <div *ngIf="selectedCharacter && movieScene" class="movie-scene-panel">
    <div class="panel-header">
      <div class="panel-header-top">
        <h3>{{ selectedCharacter.character }} - {{ selectedCharacter.pinyin }}</h3>
        <button class="close-btn" (click)="clearSelection()">Ã—</button>
      </div>
      <div class="panel-sub-header">
        <h4>{{ movieScene.initial }}{{ movieScene.final }}</h4>
      </div>
    </div>
    <div class="panel-content">
      <div class="info-section">
        <h4>Actor</h4>
        <p>{{ movieScene.actor }}</p>
      </div>
      <div class="info-section">
        <h4>Set Location</h4>
        <p>{{ movieScene.set }}</p>
      </div>
      <div class="info-section">
        <h4>Tone Location (Tone {{ movieScene.tone }})</h4>
        <p>{{ blueprint.tones[movieScene.tone] }}</p>
      </div>
      <div class="info-section">
        <h4>Radical Props</h4>
        <p>
          <ng-container *ngFor="let prop of getCharacterRadicalProps(selectedCharacter)">
            <div>
              <span class="prop-item">{{ prop.radical }}</span> &nbsp;&nbsp;&nbsp;&nbsp; (
              <span class="prop-item">{{ prop.prop }}</span
              >)
            </div>
          </ng-container>
        </p>
      </div>
      <div class="info-section">
        <h4>Movie</h4>
        <ng-container *ngIf="selectedCharacter.movie">
          <p class="movie-text">{{ selectedCharacter.movie }}</p>
        </ng-container>
        <ng-container *ngIf="!selectedCharacter.movie">
          <button
            class="generate-movie-btn"
            (click)="generateMovie()"
            [disabled]="isGeneratingMovie"
          >
            <ng-container *ngIf="!isGeneratingMovie">Generate Movie</ng-container>
            <ng-container *ngIf="isGeneratingMovie">Generating...</ng-container>
          </button>
        </ng-container>
      </div>
    </div>
  </div>
</div>
