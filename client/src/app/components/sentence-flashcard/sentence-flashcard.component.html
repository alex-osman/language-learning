<div class="sentence-flashcards-container">
  <!-- Header -->
  <div class="header">
    <button class="back-btn" (click)="goBackToScene()" aria-label="Back to scene">
      ‚Üê Back to Scene
    </button>
    <h1>Sentence Practice</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <p>Loading sentences...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button (click)="loadSceneSentences()">Try Again</button>
  </div>

  <!-- Review in Progress -->
  <div
    *ngIf="isReviewing && currentSentence"
    class="review-container"
    [class.flipped-mode]="isFlipped"
  >
    <div class="review-progress">
      <p>{{ reviewStats.current }} of {{ reviewStats.total }} sentences</p>
      <app-progress-indicator
        type="linear"
        [value]="(reviewStats.current / reviewStats.total) * 100"
        theme="primary"
        [height]="12"
        [showLabel]="false"
        [animated]="true"
      ></app-progress-indicator>
    </div>

    <div
      class="flashcard"
      [class.flipped]="isFlipped"
      [class.processing]="isProcessingReview"
      (click)="flipCard()"
      role="button"
      tabindex="0"
      (keydown.space)="flipCard()"
      aria-label="Sentence flashcard - tap to flip"
    >
      <div class="flashcard-inner">
        <div class="flashcard-front">
          <div class="sentence-chinese" [class.processing]="isProcessingReview">
            {{ currentSentence.sentence }}
          </div>
          <p class="hint">Tap to reveal translation</p>
        </div>
        <div class="flashcard-back" [class.processing]="isProcessingReview">
          <div class="sentence-chinese">{{ currentSentence.sentence }}</div>
          <div class="sentence-pinyin">{{ currentSentence.pinyin }}</div>
          <div class="sentence-translation">{{ currentSentence.translation }}</div>
          <button
            class="audio-btn"
            (click)="$event.stopPropagation(); playAudio()"
            [disabled]="isProcessingReview"
            aria-label="Play audio pronunciation"
          >
            üîä Play Audio
          </button>
        </div>
      </div>
    </div>

    <!-- Rating buttons that appear when card is flipped -->
    <div class="review-actions-wrapper" *ngIf="isFlipped" [class.processing]="isProcessingReview">
      <div class="review-actions-content">
        <p>How well did you remember this?</p>
        <div class="rating-buttons-compact" [class.disabled]="isProcessingReview">
          <button
            class="rating-btn bad"
            (click)="submitReview(0)"
            [disabled]="isProcessingReview"
            [class.selected]="selectedRating === 0"
            aria-label="0 - Complete illusion"
          >
            <span class="rating-number">0</span>
            <span class="rating-text">Complete illusion</span>
          </button>
          <button
            class="rating-btn bad"
            (click)="submitReview(1)"
            [disabled]="isProcessingReview"
            [class.selected]="selectedRating === 1"
            aria-label="1 - Remembered with help"
          >
            <span class="rating-number">1</span>
            <span class="rating-text">Remembered with help</span>
          </button>
          <button
            class="rating-btn bad"
            (click)="submitReview(2)"
            [disabled]="isProcessingReview"
            [class.selected]="selectedRating === 2"
            aria-label="2 - Incorrect but seems easy"
          >
            <span class="rating-number">2</span>
            <span class="rating-text">Incorrect but seems easy</span>
          </button>
          <button
            class="rating-btn ok"
            (click)="submitReview(3)"
            [disabled]="isProcessingReview"
            [class.selected]="selectedRating === 3"
            aria-label="3 - Correct by thinking"
          >
            <span class="rating-number">3</span>
            <span class="rating-text">Correct by thinking</span>
          </button>
          <button
            class="rating-btn good"
            (click)="submitReview(4)"
            [disabled]="isProcessingReview"
            [class.selected]="selectedRating === 4"
            aria-label="4 - Correct with hesitation"
          >
            <span class="rating-number">4</span>
            <span class="rating-text">Correct with hesitation</span>
          </button>
          <button
            class="rating-btn perfect"
            (click)="submitReview(5)"
            [disabled]="isProcessingReview"
            [class.selected]="selectedRating === 5"
            aria-label="5 - Perfect recall"
          >
            <span class="rating-number">5</span>
            <span class="rating-text">Perfect recall</span>
          </button>
        </div>
        <div *ngIf="isProcessingReview" class="processing-indicator">
          <p>Processing...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Completed -->
  <div *ngIf="reviewCompleted" class="review-completed">
    <div class="completion-message">
      <h2>üéâ Scene Practice Complete!</h2>
      <p>You've practiced all {{ reviewStats.total }} sentences from this scene.</p>
      <div class="completion-stats">
        <div class="stat">
          <span class="stat-number">{{ reviewStats.correct }}</span>
          <span class="stat-label">Correct</span>
        </div>
        <div class="stat">
          <span class="stat-number">{{ reviewStats.incorrect }}</span>
          <span class="stat-label">Incorrect</span>
        </div>
        <div class="stat">
          <span class="stat-number"
            >{{ Math.round((reviewStats.correct / reviewStats.total) * 100) }}%</span
          >
          <span class="stat-label">Accuracy</span>
        </div>
      </div>
      <button class="completion-btn" (click)="goBackToScene()">Back to Scene</button>
    </div>
  </div>
</div>
